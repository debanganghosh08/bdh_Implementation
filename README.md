# BDH-Driven Narrative Consistency Detection

This repository contains a **BDH-inspired system** for checking whether a hypothetical character backstory is **consistent or contradictory** with a full-length novel (100k+ words).

The system processes the entire narrative sequentially, extracts **BDH tension signals**, and produces a final **binary consistency judgment**.

---

## ğŸ“ Project Structure

```
KDSH_2026/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ train.csv          # Training set with ground-truth labels
â”‚   â”œâ”€â”€ test.csv           # Test set (no labels)
â”‚   â”œâ”€â”€ *.txt              # Full novel texts
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ bdh_kernel.py      # BDH-inspired reasoning module
â”‚   â”œâ”€â”€ classifier.py      # Tension classification head
â”‚
â”œâ”€â”€ extract_tension_train.py  # Extract BDH features on train set
â”œâ”€â”€ train_head.py             # Train tension classifier
â”œâ”€â”€ run_bdh.py                # Run inference on test set
â”œâ”€â”€ visualize_tension.py      # Optional analysis plots
â”œâ”€â”€ main.py                   # End-to-end pipeline runner
â”‚
â”œâ”€â”€ results.csv               # Final predictions (generated)
â””â”€â”€ README.md
```

---

## âš™ï¸ Environment Setup

Create a Python environment (recommended Python 3.9+), then install dependencies:

```bash
pip install torch sentence-transformers pandas numpy tqdm matplotlib
```

---

## â–¶ï¸ Running the Full Pipeline (Recommended)

Run **everything automatically** using:

```bash
python main.py
```

This will:

1. Extract BDH tension features from `train.csv`
2. Train the tension classifier
3. Run inference on `test.csv`
4. Generate `results.csv`

---

## ğŸ” Running Step-by-Step (Optional)

If you want to run manually:

```bash
python extract_tension_train.py
python train_head.py
python run_bdh.py
```

---

## ğŸ“¤ Output Format

The final output is saved as:

```
results.csv
```

Example:

```
id,prediction,label
95,0,Contradict
59,1,Consistent
27,1,Consistent
```

### Column Meaning

| Column       | Description                        |
| ------------ | ---------------------------------- |
| `id`         | Sample identifier                  |
| `prediction` | `1` = Consistent, `0` = Contradict |
| `label`      | Human-readable prediction          |

---

## ğŸ“Š Optional Visualization

To visualize BDH tension behavior:

```bash
python visualize_tension.py
```

This helps inspect how narrative tension evolves across the novel.

---

## ğŸ§  How the System Works (High Level)

* The novel is processed **chunk by chunk**
* A **persistent BDH state** accumulates narrative tension
* Multiple tension features are extracted
* A trained classifier maps tension profiles to consistency labels

No truncation, summarization, or retrieval shortcuts are used.

---

## âœ… Expected Results

* Non-uniform predictions (both Consistent and Contradict)
* Stable outputs across runs
* Reproducible end-to-end execution

---

## ğŸ“Œ Notes

* This system is designed for **Track B (BDH-Driven Narrative Reasoning)**
* BDH is used as a **diagnostic reasoning probe**, not a pretrained language model
* Evidence rationales are optional and not generated by default

---


## ğŸ“„ Citation

If you reference this work, please cite:

*Baby Dragon Hatchling (BDH) â€” original research paper*

*HuggingFace Sentence-Transformers*

*KDSH 2026 Track B Dataset*

## Final Note

This system is designed as a research-oriented prototype, emphasizing reasoning quality, constraint tracking, and narrative causality rather than leaderboard optimization.
